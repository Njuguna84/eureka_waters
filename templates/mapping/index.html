<!-- loading django static files -->
{% load static %}

<!DOCTYPE html>
<html>

<head>
    <!-- Bootstrap -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap-theme.min.css">

    <!-- Loading Django-Leaflet -->
    {% load leaflet_tags %}
    {% leaflet_js %}
    {% leaflet_css %}

    <!--CSS-->
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'leaflet/leaflet-groupedLayers/leaflet.groupedlayercontrol.min.css' %}">

    <!-- loading leaflet plugins -->
    <script src="{% static 'leaflet/leaflet.ajax.js' %}"></script>
    <script src="{% static 'leaflet/leaflet-groupedLayers/leaflet.groupedlayercontrol.min.js' %}"></script>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Eureka Water Meters</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">


</head>

<body>
    <h3>A Visualization of our Client Meters</h3>


    <script type="text/javascript">
        function maps_layers(map, options) {
            //Loading background tilelayers from their link servers
            var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
            var grayscale = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png');

            //


            //loading the client_meters layers 
            var c_meters = new L.GeoJSON.AJAX("{% url 'eureka_maps:c_meters' %}", {
                pointToLayer: (feature, latlng) => {
                    var customicon = L.icon({
                        iconSize: [50, 70],
                        iconAnchor: [12, 28],
                        popupAnchor: [0, 25],
                        iconUrl: "static/markers/all.svg"
                    });
                    return L.marker(latlng, { icon: customicon });
                },
                onEachFeature: (feature, layer) => {
                    layer.bindPopup(
                        '<b> Client Name: </b>' + feature.properties.client_name.toString() +
                        '<br/>' + '<b> Client Code: </b>' + feature.properties.client_code.toString() +
                        '<br/>' + '<b> Current Reading: </b>' + feature.properties.is_bulk.toString() +
                        '<br/>' + '<b> Is Bulk: </b>' + feature.properties.is_bulk.toString()
                    )
                }
            });


            //adding the layers to the map

            c_meters.addTo(map);

            // setting the layers for control layers which allows 
            // the user to switch among the various layers added.
            var baseLayers = {
                "OSM": osm,
                "Grayscale": grayscale,
            }
            var groupedOverlays = {
                "Layers": {
                    "All Clients Meters": c_meters,
                }
            };

            L.control.groupedLayers(baseLayers, groupedOverlays).addTo(map);
        }
    </script>

    {% leaflet_map "Eureka_Water_Map" callback="window.maps_layers" %}

</body>

</html>